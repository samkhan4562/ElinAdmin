<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ElinFragrance - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .sidebar { background-color: #1f2937; color: #d1d5db; transition: transform 0.3s ease-in-out; z-index: 40; width: 16rem; transform: translateX(-100%); position: fixed; height: 100vh; }
        .sidebar.active { transform: translateX(0); box-shadow: 0 0 15px rgba(0, 0, 0, 0.2); }
        @media (min-width: 1024px) { .sidebar { transform: translateX(0); position: static; height: auto; } }
        .sidebar a { border-left: 3px solid transparent; transition: all 0.2s; }
        .sidebar a:hover { background-color: #374151; }
        .sidebar a.active { background-color: #714329; color: white; border-left-color: #B08463; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.5s; }
        .btn { padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 600; transition: all 0.2s; }
        .btn:active { transform: scale(0.95); }
        .btn-primary { background-color: #714329; color: white; }
        .btn-primary:hover { background-color: #5a3521; }
        .btn-danger { background-color: #ef4444; color: white; }
        .btn-secondary { background-color: #6b7280; color: white; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid #e5e7eb; }
        th { background-color: #f9fafb; font-weight: 600; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 30; display: none; }
        .sidebar-overlay.active { display: block; }
        .modal { display: none; }
        .modal.active { display: flex; }
    </style>
</head>
<body>
<div id="admin-login-view" class="min-h-screen flex items-center justify-center bg-gray-100">
    <div class="w-full max-w-md p-8 space-y-6 bg-white rounded-lg shadow-md">
        <h1 class="text-3xl font-bold text-center text-gray-900">ElinFragrance Admin</h1>
        <input id="admin-email" type="email" placeholder="Admin Email" class="w-full px-4 py-2 border rounded-lg">
        <input id="admin-password" type="password" placeholder="Password" class="w-full px-4 py-2 border rounded-lg">
        <button id="admin-login-btn" class="w-full btn btn-primary">Login</button>
        <p id="login-error" class="text-red-500 text-center"></p>
    </div>
</div>

<div id="admin-dashboard" class="hidden">
    <div class="flex h-screen relative lg:static">
        <div id="sidebar-overlay" class="sidebar-overlay lg:hidden"></div>
        <aside id="sidebar" class="sidebar w-64 flex-shrink-0">
            <div class="p-4 text-2xl font-bold text-white flex justify-between items-center">ElinFragrance Admin <button id="close-sidebar-btn" class="lg:hidden text-white"><i data-lucide="x" class="w-6 h-6"></i></button></div>
            <nav class="mt-8">
                <a href="#" class="nav-link block py-3 px-4 active" data-page="dashboard-page"><i data-lucide="layout-grid" class="inline-block w-5 h-5 mr-2"></i>Dashboard</a>
                <a href="#" class="nav-link block py-3 px-4" data-page="products-page"><i data-lucide="package" class="inline-block w-5 h-5 mr-2"></i>Products</a>
                <a href="#" class="nav-link block py-3 px-4" data-page="users-page"><i data-lucide="users" class="inline-block w-5 h-5 mr-2"></i>User Management</a>
                <a href="#" id="admin-logout-btn" class="block py-3 px-4 mt-8"><i data-lucide="log-out" class="inline-block w-5 h-5 mr-2"></i>Logout</a>
            </nav>
        </aside>

        <main class="flex-1 p-4 sm:p-6 md:p-8 overflow-y-auto">
            <div class="lg:hidden mb-4"><button id="menu-toggle" class="p-2 bg-gray-200 rounded-md"><i data-lucide="menu" class="w-6 h-6"></i></button></div>

            <div id="dashboard-page" class="page active">
                 <h1 class="text-3xl font-bold mb-6">Dashboard</h1>
                 <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                     <div class="bg-white p-6 rounded-lg shadow"><h2 class="text-gray-500 text-lg">Total Users</h2><p id="total-users" class="text-4xl font-bold">0</p></div>
                     <div class="bg-white p-6 rounded-lg shadow"><h2 class="text-gray-500 text-lg">Total Products</h2><p id="total-products" class="text-4xl font-bold">0</p></div>
                 </div>
            </div>

            <div id="products-page" class="page">
                 <div class="flex justify-between items-center mb-6">
                     <h1 class="text-3xl font-bold">Product Management</h1>
                     <button id="add-product-btn" class="btn btn-primary"><i data-lucide="plus" class="inline-block w-5 h-5 mr-2"></i>Add Product</button>
                 </div>
                 <div class="bg-white shadow rounded-lg overflow-x-auto"><table class="min-w-full"><thead><tr><th>Name</th><th>Category</th><th>Price</th><th>Actions</th></tr></thead><tbody id="products-table-body"></tbody></table></div>
            </div>

            <div id="users-page" class="page">
                 <h1 class="text-3xl font-bold mb-6">User Management</h1>
                 <div class="mb-4"><input type="text" id="user-search" placeholder="Search by name or email..." class="w-full max-w-md px-4 py-2 border rounded-lg"></div>
                 <div class="bg-white shadow rounded-lg overflow-x-auto"><table class="min-w-full"><thead><tr><th>Username</th><th>Email</th><th>Status</th><th>Flags</th><th>Actions</th></tr></thead><tbody id="users-table-body"></tbody></table></div>
            </div>
            
        </main>
    </div>
</div>

 <div id="product-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg p-6 w-full max-w-2xl shadow-xl max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-4 border-b pb-2"><h2 id="product-modal-title" class="text-2xl font-bold">Add Product</h2><button id="product-modal-close-btn" class="text-gray-500 hover:text-gray-800"><i data-lucide="x" class="w-6 h-6"></i></button></div>
        <form id="product-form" class="space-y-4">
            <input type="hidden" id="product-id">
            <div><label for="p-name" class="block font-semibold mb-1">Product Name</label><input type="text" id="p-name" class="w-full px-3 py-2 border rounded-lg" required></div>
            <div><label for="p-description" class="block font-semibold mb-1">Description</label><textarea id="p-description" class="w-full px-3 py-2 border rounded-lg" rows="3"></textarea></div>
            <div><label for="p-category" class="block font-semibold mb-1">Category</label>
                <select id="p-category" class="w-full px-3 py-2 border rounded-lg" required>
                    <option value="men">Men's Fragrances</option>
                    <option value="women">Women's Fragrances</option>
                    <option value="unisex">Unisex Fragrances</option>
                </select>
            </div>
             <div>
                <label for="p-image" class="block font-semibold mb-1">Image URL</label>
                <input type="text" id="p-image" class="w-full px-3 py-2 border rounded-lg" placeholder="https://images.unsplash.com/..." required>
            </div>
            <div>
                <label class="block font-semibold mb-1">Sizes & Prices</label>
                <div id="p-sizes-container" class="space-y-2">
                    <!-- Dynamic sizes will be added here -->
                </div>
                <button type="button" id="add-size-btn" class="mt-2 text-sm btn btn-secondary">Add Size</button>
            </div>
            <div class="flex justify-end space-x-4 mt-6 border-t pt-4"><button type="button" id="product-modal-cancel-btn" class="btn bg-gray-200 text-gray-800">Cancel</button><button type="submit" class="btn btn-primary">Save Product</button></div>
        </form>
    </div>
</div>

<div id="custom-alert" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70] p-4"><div class="bg-white rounded-lg p-6 w-full max-w-sm text-center shadow-xl"><p id="alert-message" class="mb-4"></p><button id="alert-ok-btn" class="btn btn-primary px-6">OK</button></div></div>
<div id="custom-confirm" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70] p-4"><div class="bg-white rounded-lg p-6 w-full max-w-sm text-center shadow-xl"><p id="confirm-message" class="mb-6"></p><div class="flex justify-center space-x-4"><button id="confirm-cancel-btn" class="btn bg-gray-200">Cancel</button><button id="confirm-ok-btn" class="btn btn-danger px-6">Confirm</button></div></div></div>

<script>
    // --- SUPABASE CONFIG ---
    const SUPABASE_URL = 'https://ylfgywcjczto.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN5dWF1bGdmZ3ljb3dqY2NjaXpvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzMjQ1MDMsImV4cCI6MjA3NDkwMDUwM30.IfgrCv-4oJQpQgz5g8s8a-o8USK8gto0MDinW7BSExc';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // --- GLOBAL STATE ---
    let allUsers = [];
    let allProducts = [];

    // --- INITIALIZATION ---
    window.onload = async () => {
        lucide.createIcons();
        setupEventListeners();
        const { data: { session } } = await supabase.auth.getSession();
        if (session) {
            document.getElementById('admin-login-view').style.display = 'none';
            document.getElementById('admin-dashboard').style.display = 'block';
            navigateTo('dashboard-page');
            loadInitialData();
        } else {
            document.getElementById('admin-login-view').style.display = 'flex';
            document.getElementById('admin-dashboard').style.display = 'none';
        }
    };
    
    async function loadInitialData() {
        await loadUsers(); 
        await loadProducts();
        updateDashboardStats();
    }

    // --- AUTHENTICATION ---
    function showLoginError(message) { document.getElementById('login-error').textContent = message; }
    async function handleAdminLogin() {
        const email = document.getElementById('admin-email').value;
        const password = document.getElementById('admin-password').value;
        showLoginError('');
        const { error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) {
            showLoginError(error.message);
        } else {
            window.location.reload();
        }
    }

    async function handleAdminLogout() {
        await supabase.auth.signOut();
        window.location.reload();
    }

    // --- EVENT LISTENERS ---
    function setupEventListeners() {
        document.getElementById('admin-login-btn').addEventListener('click', handleAdminLogin);
        document.getElementById('admin-logout-btn').addEventListener('click', handleAdminLogout);
        document.querySelectorAll('.nav-link').forEach(link => link.addEventListener('click', (e) => { e.preventDefault(); navigateTo(link.dataset.page); }));
        document.getElementById('menu-toggle').addEventListener('click', () => { document.getElementById('sidebar').classList.add('active'); document.getElementById('sidebar-overlay').classList.add('active'); });
        document.getElementById('close-sidebar-btn').addEventListener('click', () => { document.getElementById('sidebar').classList.remove('active'); document.getElementById('sidebar-overlay').classList.remove('active'); });
        document.getElementById('sidebar-overlay').addEventListener('click', () => { document.getElementById('sidebar').classList.remove('active'); document.getElementById('sidebar-overlay').classList.remove('active'); });
        document.getElementById('user-search').addEventListener('input', (e) => renderUsersTable(e.target.value));
        
        // Product Modal
        document.getElementById('add-product-btn').addEventListener('click', () => openProductModal());
        document.getElementById('product-modal-close-btn').addEventListener('click', () => document.getElementById('product-modal').classList.remove('active'));
        document.getElementById('product-modal-cancel-btn').addEventListener('click', () => document.getElementById('product-modal').classList.remove('active'));
        document.getElementById('product-form').addEventListener('submit', handleProductFormSubmit);
        document.getElementById('add-size-btn').addEventListener('click', addSizeInput);
    }

    // --- UI & NAVIGATION ---
    function navigateTo(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
            if (link.dataset.page === pageId) link.classList.add('active');
        });
        if (window.innerWidth < 1024) {
             document.getElementById('sidebar').classList.remove('active');
             document.getElementById('sidebar-overlay').classList.remove('active');
        }
    }
    
    // --- DATA LOADING & RENDERING ---
    async function loadUsers() {
        const { data, error } = await supabase.from('users').select('*');
        if (error) {
            showAlert('Error fetching users: ' + error.message);
            return;
        }
        allUsers = data;
        renderUsersTable();
    }

    async function loadProducts() {
        const { data, error } = await supabase.from('products').select('*');
        if (error) {
            showAlert('Error fetching products: ' + error.message);
            return;
        }
        allProducts = data;
        renderProductsTable();
    }

    function updateDashboardStats() {
        document.getElementById('total-users').textContent = allUsers.length;
        document.getElementById('total-products').textContent = allProducts.length;
    }

    // --- USER MANAGEMENT ---
    function renderUsersTable(searchTerm = '') {
        const tableBody = document.getElementById('users-table-body');
        tableBody.innerHTML = '';
        const filteredUsers = allUsers.filter(user => 
            (user.username || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
            (user.email || '').toLowerCase().includes(searchTerm.toLowerCase())
        );
        
        filteredUsers.forEach(user => {
            const isBlocked = user.is_blocked || false;
            const flags = user.flags || 0;
            const row = tableBody.insertRow();
            row.innerHTML = `
                <td class="font-medium">${user.username || 'N/A'}</td>
                <td>${user.email}</td>
                <td><span class="px-2 py-1 text-xs font-semibold rounded-full ${isBlocked ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">${isBlocked ? 'Blocked' : 'Active'}</span></td>
                <td>${flags > 0 ? `<span class="text-red-500 font-bold">${flags} Flags</span>` : 'None'}</td>
                <td class="space-x-2 whitespace-nowrap">
                    <button class="btn bg-yellow-500 text-white text-xs flag-user-btn" data-user-id="${user.id}">Flag</button>
                    <button class="btn ${isBlocked ? 'bg-green-500 hover:bg-green-600' : 'btn-danger'} text-white text-xs block-user-btn" data-user-id="${user.id}" data-is-blocked="${isBlocked}">${isBlocked ? 'Unblock' : 'Block'}</button>
                </td>`;
        });

        document.querySelectorAll('.flag-user-btn').forEach(btn => btn.addEventListener('click', (e) => flagUser(e.target.dataset.userId)));
        document.querySelectorAll('.block-user-btn').forEach(btn => btn.addEventListener('click', (e) => toggleBlockUser(e.target.dataset.userId, e.target.dataset.isBlocked === 'true')));
    }

    async function flagUser(userId) {
        const user = allUsers.find(u => u.id === parseInt(userId));
        const currentFlags = user.flags || 0;
        showConfirm(`Are you sure you want to add a red flag to this user?`, async () => {
            const { error } = await supabase.from('users').update({ flags: currentFlags + 1 }).eq('id', userId);
            if (error) {
                showAlert('Error flagging user: ' + error.message);
            } else {
                showAlert('User has been flagged.');
                loadUsers();
            }
        });
    }

    function toggleBlockUser(userId, isCurrentlyBlocked) {
        const action = isCurrentlyBlocked ? 'unblock' : 'block';
        showConfirm(`Are you sure you want to ${action} this user?`, async () => {
             const { error } = await supabase.from('users').update({ is_blocked: !isCurrentlyBlocked }).eq('id', userId);
             if (error) {
                 showAlert(`Error ${action}ing user: ` + error.message);
             } else {
                showAlert(`User has been ${action}ed.`);
                loadUsers();
             }
        });
    }

    // --- PRODUCT MANAGEMENT ---
    function renderProductsTable() {
        const tableBody = document.getElementById('products-table-body');
        tableBody.innerHTML = '';
        allProducts.forEach(p => {
            const row = tableBody.insertRow();
            const minPrice = Math.min(...p.sizes.map(s => s.price));
            row.innerHTML = `
                <td class="font-medium">${p.name}</td>
                <td>${p.category}</td>
                <td>Starts at ₹${minPrice}</td>
                <td class="space-x-2 whitespace-nowrap">
                    <button class="btn btn-secondary text-xs edit-product-btn" data-product-id="${p.id}">Edit</button>
                    <button class="btn btn-danger text-xs delete-product-btn" data-product-id="${p.id}">Delete</button>
                </td>`;
        });

        document.querySelectorAll('.edit-product-btn').forEach(b => b.onclick = (e) => openProductModal(allProducts.find(p => p.id === parseInt(e.target.dataset.productId))));
        document.querySelectorAll('.delete-product-btn').forEach(b => b.onclick = (e) => deleteProduct(e.target.dataset.productId));
    }

    function openProductModal(product = null) {
        const form = document.getElementById('product-form');
        form.reset();
        document.getElementById('product-id').value = '';
        document.getElementById('p-sizes-container').innerHTML = '';
        
        if (product) {
            document.getElementById('product-modal-title').textContent = "Edit Product";
            document.getElementById('product-id').value = product.id;
            document.getElementById('p-name').value = product.name;
            document.getElementById('p-description').value = product.description;
            document.getElementById('p-category').value = product.category;
            document.getElementById('p-image').value = product.image;
            product.sizes.forEach(size => addSizeInput(size.volume, size.price));
        } else {
             document.getElementById('product-modal-title').textContent = "Add Product";
             addSizeInput('30ml', ''); // Add one default size input
        }
        document.getElementById('product-modal').classList.add('active');
    }

    function addSizeInput(volume = '', price = '') {
        const container = document.getElementById('p-            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .order-summary {
            background: var(--neutral-light);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .place-order-btn {
            width: 100%;
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 1.25rem;
            border-radius: var(--border-radius);
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
        }

        .place-order-btn:hover {
            background: var(--text-dark);
            transform: translateY(-2px);
        }

        /* Orders Page */
        .order-card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .order-card:hover {
            box-shadow: var(--shadow-hover);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .order-id-text {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .order-date {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .order-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-processing {
            background: #fff3cd;
            color: #856404;
        }

        .status-shipped {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-delivered {
            background: #d4edda;
            color: #155724;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .order-items {
            margin-bottom: 1.5rem;
        }

        .order-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--neutral-light);
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .order-item-image {
            width: 60px;
            height: 60px;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
        }

        .order-item-info {
            flex: 1;
        }

        .order-item-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }

        .order-item-details {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .order-item-price {
            font-weight: 600;
            color: var(--primary);
        }

        .order-total {
            text-align: right;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .tracking-info {
            background: var(--neutral-light);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .tracking-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
        }

        .tracking-steps::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            height: 2px;
            background: var(--neutral-gray);
            z-index: 1;
        }

        .tracking-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            background: var(--neutral-light);
            padding: 0 0.5rem;
        }

        .tracking-step-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--neutral-gray);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
        }

        .tracking-step.completed .tracking-step-icon {
            background: var(--primary);
        }

        .tracking-step.active .tracking-step-icon {
            background: var(--secondary);
        }

        .tracking-step-label {
            font-size: 0.8rem;
            text-align: center;
            color: var(--text-light);
        }

        .tracking-step.completed .tracking-step-label,
        .tracking-step.active .tracking-step-label {
            color: var(--text-dark);
            font-weight: 600;
        }

        /* Thank You Page */
        .thank-you-section {
            margin-top: 80px;
            padding: 6rem 0;
            text-align: center;
        }

        .thank-you-content {
            max-width: 600px;
            margin: 0 auto;
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 3rem;
            box-shadow: var(--shadow);
        }

        .success-icon {
            font-size: 4rem;
            color: #27ae60;
            margin-bottom: 2rem;
        }

        .order-id {
            background: var(--neutral-light);
            padding: 1rem;
            border-radius: 12px;
            margin: 2rem 0;
            font-family: monospace;
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* Loading Spinner */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(250, 249, 246, 0.9);
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--neutral-light);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.6s ease;
        }

        /* Responsive Design */
        
        /* Large Desktop & MacBook Pro (1440px+) */
        @media (min-width: 1440px) {
            .nav-container,
            .container,
            .checkout-container {
                max-width: 1400px;
                padding: 0 3rem;
            }
            
            .hero-container {
                max-width: 1400px;
                padding: 0 3rem;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
                gap: 2.5rem;
            }
            
            .hero-content h1 {
                font-size: 4rem;
            }
        }
        
        /* MacBook Air & Standard Laptop (1024px - 1439px) */
        @media (min-width: 1024px) and (max-width: 1439px) {
            .nav-container,
            .container,
            .checkout-container {
                max-width: 1200px;
                padding: 0 2rem;
            }
            
            .hero-container {
                max-width: 1200px;
                padding: 0 2rem;
                gap: 3rem;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 2rem;
            }
            
            .hero-content h1 {
                font-size: 3.2rem;
            }
            
            .product-detail {
                gap: 2rem;
            }
        }
        
        /* Tablet Landscape (768px - 1023px) */
        @media (min-width: 768px) and (max-width: 1023px) {
            .nav-container,
            .container,
            .checkout-container {
                padding: 0 2rem;
            }
            
            .hero-container {
                grid-template-columns: 1fr 1fr;
                gap: 2rem;
                padding: 0 2rem;
            }
            
            .hero-content h1 {
                font-size: 2.8rem;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
                gap: 1.5rem;
            }
            
            .filters-container {
                flex-wrap: wrap;
                gap: 1rem;
            }
            
            .search-bar {
                flex: 1;
                min-width: 200px;
            }
            
            .product-detail {
                grid-template-columns: 1fr 1fr;
                gap: 1.5rem;
            }
            
            .cart-item {
                grid-template-columns: 80px 1fr auto auto;
                gap: 1rem;
            }
        }
        
        /* Tablet Portrait & Mobile Landscape (481px - 767px) */
        @media (min-width: 481px) and (max-width: 767px) {
            .mobile-menu-toggle {
                display: block;
            }

            .mobile-cart {
                display: flex;
            }

            .nav-menu .cart-icon {
                display: none;
            }

            .nav-menu {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                background: var(--white);
                flex-direction: column;
                padding: 1rem;
                box-shadow: var(--shadow);
                border-radius: 0 0 var(--border-radius) var(--border-radius);
            }

            .nav-menu.active {
                display: flex;
            }
            
            .nav-container,
            .container,
            .checkout-container {
                padding: 0 1.5rem;
            }

            .hero {
                padding: 4rem 0;
                min-height: 50vh;
            }

            .hero-container {
                padding: 0 1.5rem;
            }

            .hero-content h1 {
                font-size: 2.5rem;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
                gap: 1.5rem;
            }

            .product-detail {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .cart-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .cart-item-image {
                width: 80px;
                height: 80px;
                align-self: center;
            }

            .cart-actions {
                flex-direction: row;
                align-items: center;
                align-self: stretch;
                justify-content: space-between;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .filters-container {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }

            .search-bar {
                min-width: auto;
            }

            .order-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .tracking-steps {
                flex-wrap: wrap;
                gap: 1rem;
            }

            .tracking-step {
                flex: 1;
                min-width: 80px;
            }
        }

        /* Mobile Portrait (320px - 480px) */
        @media (max-width: 480px) {
            .mobile-menu-toggle {
                display: block;
            }

            .mobile-cart {
                display: flex;
            }

            .nav-menu .cart-icon {
                display: none;
            }

            .nav-menu {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                background: var(--white);
                flex-direction: column;
                padding: 1rem;
                box-shadow: var(--shadow);
                border-radius: 0 0 var(--border-radius) var(--border-radius);
            }

            .nav-menu.active {
                display: flex;
            }
            
            .nav-container,
            .container,
            .checkout-container {
                padding: 0 1rem;
            }

            .hero {
                padding: 3rem 0;
                min-height: 40vh;
            }
            
            .hero-container {
                padding: 0 1rem;
            }

            .hero-content h1 {
                font-size: 2rem;
                line-height: 1.1;
            }

            .cta-button {
                padding: 1rem 2rem;
                font-size: 1rem;
            }

            .section-title {
                font-size: 2rem;
            }

            .products-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .modal-content {
                width: 95%;
                margin: 1rem;
                max-height: 85vh;
            }

            .product-detail {
                padding: 1rem;
                gap: 1rem;
            }
            
            .product-detail-image {
                height: 250px;
            }
            
            .cart-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
                padding: 1rem;
            }
            
            .cart-item-image {
                width: 70px;
                height: 70px;
                align-self: center;
            }

            .cart-actions {
                flex-direction: row;
                align-items: center;
                align-self: stretch;
                justify-content: space-between;
            }
            
            .filters-container {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
                padding: 1rem;
            }
            
            .product-image {
                height: 200px;
            }
            
            .product-info {
                padding: 1rem;
            }

            .order-card {
                padding: 1.5rem;
            }

            .order-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }

            .tracking-steps {
                flex-direction: column;
                gap: 1rem;
            }

            .tracking-steps::before {
                display: none;
            }

            .tracking-step {
                flex-direction: row;
                align-items: center;
                justify-content: flex-start;
                gap: 1rem;
                padding: 0;
            }

            .tracking-step-icon {
                margin-bottom: 0;
            }

            .tracking-step-label {
                text-align: left;
            }
        }
        
        /* Extra Small Mobile (below 320px) */
        @media (max-width: 319px) {
            .nav-container,
            .container,
            .checkout-container,
            .hero-container {
                padding: 0 0.75rem;
            }
            
            .hero-content h1 {
                font-size: 1.75rem;
            }
            
            .section-title {
                font-size: 1.75rem;
            }
            
            .product-info {
                padding: 0.75rem;
            }
            
            .modal-content {
                width: 98%;
                margin: 0.5rem;
            }
            
            .product-detail {
                padding: 0.75rem;
            }
        }
        
        /* High DPI Displays (Retina) */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .product-image,
            .product-detail-image,
            .cart-item-image,
            .showcase-item {
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
            }
        }
        
        /* Landscape Orientation Adjustments */
        @media (orientation: landscape) and (max-height: 500px) {
            .hero {
                padding: 2rem 0;
            }
            
            .hero-content h1 {
                font-size: 2.2rem;
            }
            
            .hero-showcase {
                height: 200px;
            }
        }

        /* Remove blue highlight/outline on click */
        * {
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        button:focus,
        input:focus,
        select:focus,
        textarea:focus,
        a:focus {
            outline: none !important;
            box-shadow: none !important;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mb-2 {
            margin-bottom: 1rem;
        }

        .mt-4 {
            margin-top: 2rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-light);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: var(--neutral-gray);
        }

        /* Auth Modal */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .auth-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .auth-content {
            background: var(--white);
            border-radius: var(--border-radius);
            max-width: 400px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s ease;
            padding: 2rem;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--neutral-light);
        }

        .auth-tab {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-light);
            transition: var(--transition);
        }

        .auth-tab.active {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 100px;
            right: 2rem;
            background: var(--primary);
            color: var(--white);
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-hover);
            z-index: 1500;
            transform: translateX(400px);
            transition: var(--transition);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #27ae60;
        }

        .notification.error {
            background: #e74c3c;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div id="profile-section">
                <!-- Profile/Signup button will be inserted here -->
            </div>
            
            <!-- REPLACE THIS WITH YOUR LOGO IMAGE (1434x231) -->
            <a href="#" class="logo" data-page="home" style="position: absolute; left: 50%; transform: translateX(-50%);">
                <img src="logo.png" alt="ElinFragrance" style="height: 32px; width: auto;" onerror="this.src='https://via.placeholder.com/200x32/714329/FFFFFF?text=ElinFragrance'; this.alt='ElinFragrance Logo';">
            </a>
            
            <ul class="nav-menu">
                <li><a href="#" class="nav-link" data-page="home">Home</a></li>
                <li><a href="#" class="nav-link" data-page="shop">Shop</a></li>
                <li><a href="#" class="nav-link" data-page="wishlist">Wishlist</a></li>
                <li><a href="#" class="nav-link" data-page="orders">My Orders</a></li>
                <li><a href="#" class="cart-icon" data-page="cart">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">0</span>
                </a></li>
            </ul>
            <div class="mobile-nav-icons">
                <a href="#" class="cart-icon mobile-cart" data-page="cart">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">0</span>
                </a>
                <button class="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main-content">
        <!-- Home Page -->
        <div id="home-page" class="page">
            <!-- Hero Section -->
            <section class="hero" style="background-image: url('banner.jpg');">
                <div class="hero-container">
                    <div class="hero-content">
                        <a href="#" class="cta-button" data-page="shop">Shop Now</a>
                    </div>
                </div>
            </section>

            <!-- Featured Products -->
            <section class="featured-section">
                <div class="container">
                    <h2 class="section-title">Featured Fragrances</h2>
                    <div class="products-grid" id="featured-products">
                        <!-- Products will be populated by JavaScript -->
                    </div>
                </div>
            </section>
        </div>

        <!-- Shop Page -->
        <div id="shop-page" class="page hidden">

            <div class="filters-section">
                <div class="filters-container">
                    <div class="search-bar">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" placeholder="Search fragrances..." id="search-input">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Category</label>
                        <select class="filter-select" id="category-filter">
                            <option value="">All Categories</option>
                            <option value="men">Men's Fragrances</option>
                            <option value="women">Women's Fragrances</option>
                            <option value="unisex">Unisex Fragrances</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Price Range</label>
                        <select class="filter-select" id="price-filter">
                            <option value="">All Prices</option>
                            <option value="0-2000">Under ₹2000</option>
                            <option value="2000-5000">₹2000 - ₹5000</option>
                            <option value="5000+">Over ₹5000</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Volume</label>
                        <select class="filter-select" id="size-filter">
                            <option value="">All Volumes</option>
                            <option value="30ml">30ml</option>
                            <option value="50ml">50ml</option>
                            <option value="100ml">100ml</option>
                            <option value="150ml">150ml</option>
                        </select>
                    </div>
                </div>
            </div>

            <section class="featured-section">
                <div class="container">
                    <div class="products-grid" id="shop-products">
                        <!-- Products will be populated by JavaScript -->
                    </div>
                </div>
            </section>
        </div>

        <!-- Cart Page -->
        <div id="cart-page" class="page hidden">
            <section class="cart-section">
                <div class="container">
                    <h1 class="section-title">Shopping Cart</h1>
                    <div id="cart-items">
                        <!-- Cart items will be populated by JavaScript -->
                    </div>
                    <div id="cart-summary" class="cart-summary hidden">
                        <div class="cart-total" id="cart-total">Total: ₹0</div>
                        <button class="checkout-btn" onclick="goToCheckout()">Proceed to Checkout</button>
                    </div>
                </div>
            </section>
        </div>

        <!-- Checkout Page -->
        <div id="checkout-page" class="page hidden">
            <section class="checkout-section">
                <div class="checkout-container">
                    <h1 class="section-title">Checkout</h1>
                    <form class="checkout-form" id="checkout-form">
                        <div class="order-summary" id="checkout-summary">
                            <!-- Order summary will be populated by JavaScript -->
                        </div>
                        
                        <h3 style="margin-bottom: 1.5rem; color: var(--primary);">Shipping Information</h3>
                        
                        <div id="previous-address-section" class="form-group" style="display: none;">
                            <label style="display: flex; align-items: center; gap: 0.75rem; cursor: pointer; background: var(--neutral-light); padding: 1rem; border-radius: 12px; margin-bottom: 1.5rem;">
                                <input type="checkbox" id="use-previous-address" style="width: 18px; height: 18px; accent-color: var(--primary);">
                                <span style="font-weight: 600; color: var(--primary);">
                                    <i class="fas fa-map-marker-alt" style="margin-right: 0.5rem;"></i>
                                    Use Previous Address
                                </span>
                            </label>
                            <div id="previous-address-display" style="background: var(--white); padding: 1rem; border-radius: 8px; border: 1px solid var(--neutral-light); font-size: 0.9rem; color: var(--text-light); display: none;">
                                <!-- Previous address will be displayed here -->
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">First Name *</label>
                                <input type="text" class="form-input" name="firstName" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Last Name *</label>
                                <input type="text" class="form-input" name="lastName" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email *</label>
                            <input type="email" class="form-input" name="email" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone Number *</label>
                            <input type="tel" class="form-input" name="phone" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Address *</label>
                            <input type="text" class="form-input" name="address" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">City *</label>
                                <input type="text" class="form-input" name="city" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">PIN Code *</label>
                                <input type="text" class="form-input" name="pincode" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">State *</label>
                            <select class="form-input" name="state" required>
                                <option value="">Select State</option>
                                <option value="Andhra Pradesh">Andhra Pradesh</option>
                                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                <option value="Assam">Assam</option>
                                <option value="Bihar">Bihar</option>
                                <option value="Chhattisgarh">Chhattisgarh</option>
                                <option value="Goa">Goa</option>
                                <option value="Gujarat">Gujarat</option>
                                <option value="Haryana">Haryana</option>
                                <option value="Himachal Pradesh">Himachal Pradesh</option>
                                <option value="Jharkhand">Jharkhand</option>
                                <option value="Karnataka">Karnataka</option>
                                <option value="Kerala">Kerala</option>
                                <option value="Madhya Pradesh">Madhya Pradesh</option>
                                <option value="Maharashtra">Maharashtra</option>
                                <option value="Manipur">Manipur</option>
                                <option value="Meghalaya">Meghalaya</option>
                                <option value="Mizoram">Mizoram</option>
                                <option value="Nagaland">Nagaland</option>
                                <option value="Odisha">Odisha</option>
                                <option value="Punjab">Punjab</option>
                                <option value="Rajasthan">Rajasthan</option>
                                <option value="Sikkim">Sikkim</option>
                                <option value="Tamil Nadu">Tamil Nadu</option>
                                <option value="Telangana">Telangana</option>
                                <option value="Tripura">Tripura</option>
                                <option value="Uttar Pradesh">Uttar Pradesh</option>
                                <option value="Uttarakhand">Uttarakhand</option>
                                <option value="West Bengal">West Bengal</option>
                                <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                                <option value="Chandigarh">Chandigarh</option>
                                <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
                                <option value="Delhi">Delhi</option>
                                <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                <option value="Ladakh">Ladakh</option>
                                <option value="Lakshadweep">Lakshadweep</option>
                                <option value="Puducherry">Puducherry</option>
                            </select>
                        </div>
                        
                        <h3 style="margin: 2rem 0 1.5rem; color: var(--primary);">Shipping Options</h3>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                <input type="radio" name="shipping" value="standard" checked>
                                <span>Standard Delivery (5-7 days) - Free for orders over ₹1000</span>
                            </label>
                        </div>
                        
                        <button type="submit" class="place-order-btn">Place Order</button>
                    </form>
                </div>
            </section>
        </div>

        <!-- Wishlist Page -->
        <div id="wishlist-page" class="page hidden">
            <section class="cart-section">
                <div class="container">
                    <h1 class="section-title">My Wishlist</h1>
                    <div id="wishlist-items">
                        <!-- Wishlist items will be populated by JavaScript -->
                    </div>
                </div>
            </section>
        </div>

        <!-- My Orders Page -->
        <div id="orders-page" class="page hidden">
            <section class="cart-section">
                <div class="container">
                    <h1 class="section-title">My Orders</h1>
                    <div id="orders-list">
                        <!-- Orders will be populated by JavaScript -->
                    </div>
                </div>
            </section>
        </div>

        <!-- Thank You Page -->
        <div id="thankyou-page" class="page hidden">
            <section class="thank-you-section">
                <div class="container">
                    <div class="thank-you-content">
                        <i class="fas fa-check-circle success-icon"></i>
                        <h1 style="color: var(--primary); margin-bottom: 1rem;">Order Confirmed!</h1>
                        <p style="font-size: 1.1rem; margin-bottom: 2rem;">Thank you for your purchase. Your order has been successfully placed.</p>
                        <div class="order-id" id="order-id-display">
                            Order ID: #TC-2024-001
                        </div>
                        <p style="color: var(--text-light); margin-bottom: 2rem;">You will receive an email confirmation shortly. Your order will be delivered within 5-7 business days.</p>
                        <a href="#" class="cta-button" data-page="home">Continue Shopping</a>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Product Detail Modal -->
    <div class="modal" id="product-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <div class="product-detail" id="product-detail-content">
                <!-- Product detail content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <!-- Auth Modal -->
    <div class="auth-modal" id="auth-modal">
        <div class="auth-content">
            <button class="modal-close" onclick="closeAuthModal()">&times;</button>
            
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
                <button class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</button>
            </div>
            
            <!-- Login Form -->
            <form class="auth-form active" id="login-form">
                <h2 style="color: var(--primary); margin-bottom: 1.5rem; text-align: center;">Welcome Back!</h2>
                
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" name="email" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" name="password" required>
                </div>
                
                <button type="submit" class="place-order-btn" style="margin-bottom: 1rem;">Login</button>
                
                <div style="text-align: center;">
                    <a href="#" onclick="switchAuthTab('forgot')" style="color: var(--primary); text-decoration: none; font-size: 0.9rem;">Forgot Password?</a>
                </div>
            </form>
            
            <!-- Signup Form -->
            <form class="auth-form" id="signup-form">
                <h2 style="color: var(--primary); margin-bottom: 1.5rem; text-align: center;">Create Account</h2>
                
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-input" name="username" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" name="email" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-input" name="phone" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" name="password" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" class="form-input" name="confirmPassword" required>
                </div>
                
                <button type="submit" class="place-order-btn">Sign Up</button>
            </form>
            
            <!-- Forgot Password Form -->
            <form class="auth-form" id="forgot-form">
                <h2 style="color: var(--primary); margin-bottom: 1.5rem; text-align: center;">Reset Password</h2>
                
                <p style="color: var(--text-light); margin-bottom: 1.5rem; text-align: center;">Enter your email address and we'll send you a link to reset your password.</p>
                
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" name="email" required>
                </div>
                
                <button type="submit" class="place-order-btn" style="margin-bottom: 1rem;">Send Reset Link</button>
                
                <div style="text-align: center;">
                    <a href="#" onclick="switchAuthTab('login')" style="color: var(--primary); text-decoration: none; font-size: 0.9rem;">Back to Login</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <span id="notification-text"></span>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://ylfgywcjczto.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN5dWF1bGdmZ3ljb3dqY2NjaXpvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzMjQ1MDMsImV4cCI6MjA3NDkwMDUwM30.IfgrCv-4oJQpQgz5g8s8a-o8USK8gto0MDinW7BSExc';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Product Data with volume-based pricing
        const products = [
            {
                id: 1,
                name: "Midnight Elegance",
                basePrice: 100, // Price per ml
                category: "men",
                image: "https://images.unsplash.com/photo-1541643600914-78b084683601?w=400&h=400&fit=crop",
                description: "A sophisticated blend of bergamot, cedar, and amber. Perfect for evening occasions and special moments.",
                sizes: [
                    { volume: "30ml", price: 1999 },
                    { volume: "50ml", price: 2999 },
                    { volume: "100ml", price: 4999 }
                ],
                featured: true
            },
            {
                id: 2,
                name: "Rose Garden",
                basePrice: 90,
                category: "women",
                image: "https://images.unsplash.com/photo-1588405748880-12d1d2a59d75?w=400&h=400&fit=crop",
                description: "Delicate rose petals with hints of jasmine and vanilla. A timeless fragrance for the modern woman.",
                sizes: [
                    { volume: "30ml", price: 1799 },
                    { volume: "50ml", price: 2699 },
                    { volume: "100ml", price: 4499 }
                ],
                featured: true
            },
            {
                id: 3,
                name: "Ocean Breeze",
                basePrice: 80,
                category: "unisex",
                image: "https://images.unsplash.com/photo-1594736797933-d0401ba2fe65?w=400&h=400&fit=crop",
                description: "Fresh aquatic notes with citrus and marine accords. Refreshing and invigorating for daily wear.",
                sizes: [
                    { volume: "30ml", price: 1599 },
                    { volume: "50ml", price: 2399 },
                    { volume: "100ml", price: 3999 }
                ],
                featured: true
            },
            {
                id: 4,
                name: "Golden Sunset",
                basePrice: 120,
                category: "women",
                image: "https://images.unsplash.com/photo-1592945403244-b3fbafd7f539?w=400&h=400&fit=crop",
                description: "Warm amber and honey with floral undertones. Luxurious and captivating for special occasions.",
                sizes: [
                    { volume: "50ml", price: 3599 },
                    { volume: "100ml", price: 5999 }
                ],
                featured: true
            },
            {
                id: 5,
                name: "Urban Legend",
                basePrice: 110,
                category: "men",
                image: "https://images.unsplash.com/photo-1615634260167-c8cdede054de?w=400&h=400&fit=crop",
                description: "Bold and masculine with leather, tobacco, and spice notes. Perfect for the confident modern man.",
                sizes: [
                    { volume: "50ml", price: 3299 },
                    { volume: "100ml", price: 5499 }
                ],
                featured: false
            },
            {
                id: 6,
                name: "Lavender Dreams",
                basePrice: 70,
                category: "unisex",
                image: "https://images.unsplash.com/photo-1571875257727-256c39da42af?w=400&h=400&fit=crop",
                description: "Calming lavender with soft musk and vanilla. Peaceful and serene for relaxation and comfort.",
                sizes: [
                    { volume: "30ml", price: 1399 },
                    { volume: "50ml", price: 2099 },
                    { volume: "100ml", price: 3499 }
                ],
                featured: false
            },
            {
                id: 7,
                name: "Citrus Burst",
                basePrice: 60,
                category: "unisex",
                image: "https://images.unsplash.com/photo-1563170351-be82bc888aa4?w=400&h=400&fit=crop",
                description: "Energizing blend of lemon, orange, and grapefruit. Fresh and vibrant for everyday confidence.",
                sizes: [
                    { volume: "30ml", price: 1199 },
                    { volume: "50ml", price: 1799 },
                    { volume: "100ml", price: 2999 }
                ],
                featured: false
            },
            {
                id: 8,
                name: "Mystic Woods",
                basePrice: 105,
                category: "men",
                image: "https://images.unsplash.com/photo-1585386959984-a4155224a1ad?w=400&h=400&fit=crop",
                description: "Deep woody notes with sandalwood and patchouli. Mysterious and alluring for the adventurous spirit.",
                sizes: [
                    { volume: "50ml", price: 3149 },
                    { volume: "100ml", price: 5249 }
                ],
                featured: false
            }
        ];

        // Showcase images for hero section
        const showcaseImages = [
            "https://images.unsplash.com/photo-1541643600914-78b084683601?w=600&h=400&fit=crop",
            "https://images.unsplash.com/photo-1588405748880-12d1d2a59d75?w=600&h=400&fit=crop",
            "https://images.unsplash.com/photo-1594736797933-d0401ba2fe65?w=600&h=400&fit=crop",
            "https://images.unsplash.com/photo-1592945403244-b3fbafd7f539?w=600&h=400&fit=crop",
            "https://images.unsplash.com/photo-1615634260167-c8cdede054de?w=600&h=400&fit=crop"
        ];

        // Global state
        let currentPage = 'home';
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let filteredProducts = [...products];
        let currentShowcaseIndex = 0;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
        });

        function initializeApp() {
            updateCartCount();
            updateProfileSection();
            renderFeaturedProducts();
            renderShopProducts();
            renderCart();
            renderWishlist();
        }

        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('[data-page]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    navigateToPage(this.dataset.page);
                });
            });

            // Mobile menu toggle
            document.querySelector('.mobile-menu-toggle').addEventListener('click', function() {
                document.querySelector('.nav-menu').classList.toggle('active');
            });

            // Search and filters
            document.getElementById('search-input').addEventListener('input', applyFilters);
            document.getElementById('category-filter').addEventListener('change', applyFilters);
            document.getElementById('price-filter').addEventListener('change', applyFilters);
            document.getElementById('size-filter').addEventListener('change', applyFilters);

            // Checkout form
            document.getElementById('checkout-form').addEventListener('submit', handleCheckout);

            // Auth forms
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('signup-form').addEventListener('submit', handleSignup);
            document.getElementById('forgot-form').addEventListener('submit', handleForgotPassword);

            // Modal close on outside click
            document.getElementById('product-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });

            document.getElementById('auth-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAuthModal();
                }
            });
        }

        function navigateToPage(page) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            
            // Show target page
            document.getElementById(page + '-page').classList.remove('hidden');
            
            // Update current page
            currentPage = page;
            
            // Close mobile menu
            document.querySelector('.nav-menu').classList.remove('active');
            
            // Scroll to top
            window.scrollTo(0, 0);
            
            // Page-specific actions
            if (page === 'cart') {
                renderCart();
            } else if (page === 'checkout') {
                renderCheckoutSummary();
            } else if (page === 'orders') {
                renderOrders();
            } else if (page === 'wishlist') {
                renderWishlist();
            }
        }

        // Showcase functionality removed as hero section now only contains Shop Now button

        function renderFeaturedProducts() {
            const container = document.getElementById('featured-products');
            const featuredProducts = products.filter(p => p.featured);
            
            container.innerHTML = featuredProducts.map(product => {
                const minPrice = Math.min(...product.sizes.map(s => s.price));
                const maxPrice = Math.max(...product.sizes.map(s => s.price));
                const priceDisplay = minPrice === maxPrice ? `₹${minPrice}` : `₹${minPrice} - ₹${maxPrice}`;
                
                return `
                    <div class="product-card fade-in" onclick="openProductModal(${product.id})">
                        <div class="product-image" style="background-image: url(${product.image})"></div>
                        <div class="product-info">
                            <h3 class="product-title">${product.name}</h3>
                            <div class="product-price">${priceDisplay}</div>
                            <button class="add-to-cart-btn" onclick="event.stopPropagation(); openProductModal(${product.id})">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderShopProducts() {
            const container = document.getElementById('shop-products');
            
            if (filteredProducts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>No products found</h3>
                        <p>Try adjusting your filters or search terms</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredProducts.map(product => {
                const minPrice = Math.min(...product.sizes.map(s => s.price));
                const maxPrice = Math.max(...product.sizes.map(s => s.price));
                const priceDisplay = minPrice === maxPrice ? `₹${minPrice}` : `₹${minPrice} - ₹${maxPrice}`;
                
                return `
                    <div class="product-card fade-in" onclick="openProductModal(${product.id})">
                        <div class="product-image" style="background-image: url(${product.image})"></div>
                        <div class="product-info">
                            <h3 class="product-title">${product.name}</h3>
                            <div class="product-price">${priceDisplay}</div>
                            <button class="add-to-cart-btn" onclick="event.stopPropagation(); openProductModal(${product.id})">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function applyFilters() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const categoryFilter = document.getElementById('category-filter').value;
            const priceFilter = document.getElementById('price-filter').value;
            const sizeFilter = document.getElementById('size-filter').value;
            
            filteredProducts = products.filter(product => {
                // Search filter
                const matchesSearch = product.name.toLowerCase().includes(searchTerm) ||
                                    product.description.toLowerCase().includes(searchTerm);
                
                // Category filter
                const matchesCategory = !categoryFilter || product.category === categoryFilter;
                
                // Price filter
                let matchesPrice = true;
                if (priceFilter) {
                    const [min, max] = priceFilter.split('-').map(p => p.replace('+', ''));
                    if (max) {
                        matchesPrice = product.price >= parseInt(min) && product.price <= parseInt(max);
                    } else {
                        matchesPrice = product.price >= parseInt(min);
                    }
                }
                
                // Size filter
                const matchesSize = !sizeFilter || product.sizes.includes(sizeFilter);
                
                return matchesSearch && matchesCategory && matchesPrice && matchesSize;
            });
            
            renderShopProducts();
        }

        function openProductModal(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const modalContent = document.getElementById('product-detail-content');
            modalContent.innerHTML = `
                <div class="product-detail-image" style="background-image: url(${product.image})"></div>
                <div class="product-detail-info">
                    <h2>${product.name}</h2>
                    <div class="product-detail-price" id="modal-price">₹${product.sizes[0].price}</div>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">${product.description}</p>
                    
                    <div class="size-selector">
                        <label class="filter-label">Volume:</label>
                        <div class="size-options">
                            ${product.sizes.map((size, index) => `
                                <button class="size-option" data-size="${size.volume}" data-price="${size.price}" ${index === 0 ? 'data-selected="true"' : ''}>${size.volume} - ₹${size.price}</button>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="quantity-selector">
                        <label class="filter-label">Quantity:</label>
                        <button class="quantity-btn" onclick="changeQuantity(-1)">-</button>
                        <input type="number" class="quantity-input" value="1" min="1" max="10" id="modal-quantity">
                        <button class="quantity-btn" onclick="changeQuantity(1)">+</button>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; align-items: stretch;">
                        <button class="add-to-cart-detail" onclick="addToCartFromModal(${product.id})" style="flex: 1; margin-bottom: 0;">
                            Add to Cart
                        </button>
                        <button class="wishlist-btn" onclick="toggleWishlist(${product.id})" id="wishlist-btn-${product.id}">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // Setup size selection with price update
            modalContent.querySelectorAll('.size-option').forEach(btn => {
                btn.addEventListener('click', function() {
                    modalContent.querySelectorAll('.size-option').forEach(b => {
                        b.classList.remove('selected');
                        b.removeAttribute('data-selected');
                    });
                    this.classList.add('selected');
                    this.setAttribute('data-selected', 'true');
                    
                    // Update price display
                    const price = this.getAttribute('data-price');
                    document.getElementById('modal-price').textContent = `₹${price}`;
                });
            });
            
            // Select first size by default
            modalContent.querySelector('.size-option').classList.add('selected');
            
            document.getElementById('product-modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('product-modal').classList.remove('active');
        }

        function changeQuantity(delta) {
            const input = document.getElementById('modal-quantity');
            const newValue = parseInt(input.value) + delta;
            if (newValue >= 1 && newValue <= 10) {
                input.value = newValue;
            }
        }

        function addToCart(productId, size = '30ml', quantity = 1, price = null) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            // If no price provided, get price from product sizes
            if (!price) {
                const sizeInfo = product.sizes.find(s => s.volume === size);
                price = sizeInfo ? sizeInfo.price : product.sizes[0].price;
            }
            
            const existingItem = cart.find(item => item.id === productId && item.size === size);
            
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({
                    id: productId,
                    name: product.name,
                    price: price,
                    image: product.image,
                    size: size,
                    quantity: quantity
                });
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            showNotification('Product added to cart!', 'success');
        }

        function addToCartFromModal(productId) {
            const selectedSizeBtn = document.querySelector('.size-option.selected');
            const selectedSize = selectedSizeBtn?.dataset.size || products.find(p => p.id === productId).sizes[0].volume;
            const selectedPrice = parseInt(selectedSizeBtn?.dataset.price || products.find(p => p.id === productId).sizes[0].price);
            const quantity = parseInt(document.getElementById('modal-quantity').value);
            
            addToCart(productId, selectedSize, quantity, selectedPrice);
            closeModal();
        }

        function updateCartCount() {
            const count = cart.reduce((total, item) => total + item.quantity, 0);
            document.querySelectorAll('.cart-count').forEach(element => {
                element.textContent = count;
                element.style.display = count > 0 ? 'flex' : 'none';
            });
        }

        function renderCart() {
            const container = document.getElementById('cart-items');
            const summaryContainer = document.getElementById('cart-summary');
            
            if (cart.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-shopping-cart"></i>
                        <h3>Your cart is empty</h3>
                        <p>Add some exquisite fragrances to get started!</p>
                        <a href="#" class="cta-button mt-4" data-page="shop">Start Shopping</a>
                    </div>
                `;
                summaryContainer.classList.add('hidden');
                return;
            }
            
            container.innerHTML = cart.map(item => `
                <div class="cart-item">
                    <div class="cart-item-image" style="background-image: url(${item.image})"></div>
                    <div class="cart-item-info">
                        <h3>${item.name}</h3>
                        <p>Volume: ${item.size}</p>
                        <div class="cart-item-price">₹${item.price}</div>
                    </div>
                    <div class="cart-quantity">
                        <button class="quantity-btn" onclick="updateCartQuantity(${item.id}, '${item.size}', -1)">-</button>
                        <span style="padding: 0 1rem;">${item.quantity}</span>
                        <button class="quantity-btn" onclick="updateCartQuantity(${item.id}, '${item.size}', 1)">+</button>
                    </div>
                    <button class="remove-btn" onclick="removeFromCart(${item.id}, '${item.size}')">Remove</button>
                </div>
            `).join('');
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('cart-total').textContent = `Total: ₹${total}`;
            summaryContainer.classList.remove('hidden');
            
            // Re-attach event listeners for navigation
            container.querySelectorAll('[data-page]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    navigateToPage(this.dataset.page);
                });
            });
        }

        function updateCartQuantity(productId, size, delta) {
            const item = cart.find(item => item.id === productId && item.size === size);
            if (!item) return;
            
            item.quantity += delta;
            
            if (item.quantity <= 0) {
                removeFromCart(productId, size);
                return;
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            renderCart();
        }

        function removeFromCart(productId, size) {
            cart = cart.filter(item => !(item.id === productId && item.size === size));
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            renderCart();
            showNotification('Item removed from cart', 'success');
        }

        function goToCheckout() {
            if (cart.length === 0) {
                showNotification('Your cart is empty!', 'error');
                return;
            }
            navigateToPage('checkout');
        }

        function renderCheckoutSummary() {
            const container = document.getElementById('checkout-summary');
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = total >= 1000 ? 0 : 50;
            const finalTotal = total + shipping;
            
            // Check if user has previous address
            const savedAddress = JSON.parse(localStorage.getItem('savedAddress'));
            if (savedAddress) {
                document.getElementById('previous-address-section').style.display = 'block';
                document.getElementById('previous-address-display').innerHTML = `
                    <strong>${savedAddress.firstName} ${savedAddress.lastName}</strong><br>
                    ${savedAddress.address}<br>
                    ${savedAddress.city}, ${savedAddress.state} - ${savedAddress.pincode}<br>
                    Phone: ${savedAddress.phone}<br>
                    Email: ${savedAddress.email}
                `;
                
                // Setup checkbox functionality
                document.getElementById('use-previous-address').addEventListener('change', function() {
                    if (this.checked) {
                        fillPreviousAddress(savedAddress);
                        document.getElementById('previous-address-display').style.display = 'block';
                    } else {
                        clearAddressForm();
                        document.getElementById('previous-address-display').style.display = 'none';
                    }
                });
            }
            
            container.innerHTML = `
                <h3 style="margin-bottom: 1rem; color: var(--primary);">Order Summary</h3>
                ${cart.map(item => `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>${item.name} (${item.size}) x ${item.quantity}</span>
                        <span>₹${item.price * item.quantity}</span>
                    </div>
                `).join('')}
                <hr style="margin: 1rem 0; border: none; border-top: 1px solid var(--neutral-light);">
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Subtotal:</span>
                    <span>₹${total}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Shipping:</span>
                    <span>${shipping === 0 ? 'Free' : '₹' + shipping}</span>
                </div>
                <hr style="margin: 1rem 0; border: none; border-top: 1px solid var(--neutral-light);">
                <div style="display: flex; justify-content: space-between; font-weight: 700; font-size: 1.1rem;">
                    <span>Total:</span>
                    <span>₹${finalTotal}</span>
                </div>
            `;
        }

        function handleCheckout(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const orderData = Object.fromEntries(formData.entries());
            
            // Validate form
            const requiredFields = ['firstName', 'lastName', 'email', 'phone', 'address', 'city', 'pincode', 'state'];
            for (let field of requiredFields) {
                if (!orderData[field]) {
                    showNotification(`Please fill in ${field.replace(/([A-Z])/g, ' $1').toLowerCase()}`, 'error');
                    return;
                }
            }
            
            // Calculate total
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = total >= 1000 ? 0 : 50;
            const finalTotal = total + shipping;
            
            // Show loading
            showLoading();
            
            // Simulate payment processing with Razorpay
            setTimeout(() => {
                hideLoading();
                processPayment(finalTotal, orderData);
            }, 1500);
        }

        function processPayment(amount, orderData) {
            // In a real application, you would integrate with Razorpay here
            // For demo purposes, we'll simulate a successful payment
            
            const options = {
                key: 'rzp_test_1234567890', // Demo key - replace with actual Razorpay key
                amount: amount * 100, // Amount in paise
                currency: 'INR',
                name: 'ThreadCraft',
                description: 'Custom T-Shirt Purchase',
                handler: function(response) {
                    // Payment successful
                    const orderId = generateOrderId();
                    
                    // Save address for future use
                    const addressData = {
                        firstName: orderData.firstName,
                        lastName: orderData.lastName,
                        email: orderData.email,
                        phone: orderData.phone,
                        address: orderData.address,
                        city: orderData.city,
                        pincode: orderData.pincode,
                        state: orderData.state
                    };
                    localStorage.setItem('savedAddress', JSON.stringify(addressData));
                    
                    // Save order to localStorage
                    const orders = JSON.parse(localStorage.getItem('orders')) || [];
                    orders.push({
                        id: orderId,
                        items: [...cart],
                        total: amount,
                        customerInfo: orderData,
                        date: new Date().toISOString(),
                        paymentId: response.razorpay_payment_id,
                        status: 'processing'
                    });
                    localStorage.setItem('orders', JSON.stringify(orders));
                    
                    // Clear cart
                    cart = [];
                    localStorage.setItem('cart', JSON.stringify(cart));
                    updateCartCount();
                    
                    // Show thank you page
                    document.getElementById('order-id-display').textContent = `Order ID: ${orderId}`;
                    navigateToPage('thankyou');
                    
                    showNotification('Payment successful! Order placed.', 'success');
                },
                prefill: {
                    name: `${orderData.firstName} ${orderData.lastName}`,
                    email: orderData.email,
                    contact: orderData.phone
                },
                theme: {
                    color: '#714329'
                }
            };
            
            // For demo purposes, simulate successful payment without actually opening Razorpay
            // In production, uncomment the next line:
            // const rzp = new Razorpay(options);
            // rzp.open();
            
            // Demo simulation:
            setTimeout(() => {
                options.handler({ razorpay_payment_id: 'pay_demo_' + Date.now() });
            }, 1000);
        }

        function generateOrderId() {
            const timestamp = Date.now();
            const random = Math.floor(Math.random() * 1000);
            return `TC-${timestamp}-${random}`;
        }

        function showLoading() {
            document.getElementById('loading').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loading').classList.remove('active');
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notification-text');
            
            text.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function renderOrders() {
            const container = document.getElementById('orders-list');
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            
            if (orders.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-box-open"></i>
                        <h3>No orders yet</h3>
                        <p>Your order history will appear here once you make your first purchase!</p>
                        <a href="#" class="cta-button mt-4" data-page="shop">Start Shopping</a>
                    </div>
                `;
                // Re-attach event listeners
                container.querySelector('[data-page]').addEventListener('click', function(e) {
                    e.preventDefault();
                    navigateToPage(this.dataset.page);
                });
                return;
            }
            
            // Sort orders by date (newest first)
            orders.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            container.innerHTML = orders.map(order => {
                const orderDate = new Date(order.date).toLocaleDateString('en-IN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                // Calculate days since order for all orders
                const daysSinceOrder = Math.floor((Date.now() - new Date(order.date)) / (1000 * 60 * 60 * 24));
                
                // Check if order is cancelled or simulate status based on order age
                let status = order.status || 'processing';
                let statusClass = 'status-processing';
                
                if (status === 'cancelled') {
                    statusClass = 'status-cancelled';
                } else {
                    if (daysSinceOrder >= 7) {
                        status = 'delivered';
                        statusClass = 'status-delivered';
                    } else if (daysSinceOrder >= 2) {
                        status = 'shipped';
                        statusClass = 'status-shipped';
                    }
                }
                
                return `
                    <div class="order-card">
                        <div class="order-header">
                            <div>
                                <div class="order-id-text">Order ${order.id}</div>
                                <div class="order-date">Placed on ${orderDate}</div>
                            </div>
                            <div class="order-status ${statusClass}">${status}</div>
                        </div>
                        
                        <div class="order-items">
                            ${order.items.map(item => `
                                <div class="order-item">
                                    <div class="order-item-image" style="background-image: url(${item.image})"></div>
                                    <div class="order-item-info">
                                        <div class="order-item-name">${item.name}</div>
                                        <div class="order-item-details">Volume: ${item.size} | Quantity: ${item.quantity}</div>
                                    </div>
                                    <div class="order-item-price">₹${item.price * item.quantity}</div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="order-total">Total: ₹${order.total}</div>
                        
                        ${status !== 'cancelled' ? `<div class="tracking-info">
                            <h4 style="margin-bottom: 1rem; color: var(--primary);">Order Tracking</h4>` : ''}
                            <div class="tracking-steps">
                                <div class="tracking-step ${daysSinceOrder >= 0 ? 'completed' : ''}">
                                    <div class="tracking-step-icon">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div class="tracking-step-label">Order Confirmed</div>
                                </div>
                                <div class="tracking-step ${daysSinceOrder >= 1 ? 'completed' : daysSinceOrder === 0 ? 'active' : ''}">
                                    <div class="tracking-step-icon">
                                        <i class="fas fa-box"></i>
                                    </div>
                                    <div class="tracking-step-label">Processing</div>
                                </div>
                                <div class="tracking-step ${daysSinceOrder >= 2 ? 'completed' : daysSinceOrder === 1 ? 'active' : ''}">
                                    <div class="tracking-step-icon">
                                        <i class="fas fa-truck"></i>
                                    </div>
                                    <div class="tracking-step-label">Shipped</div>
                                </div>
                                <div class="tracking-step ${daysSinceOrder >= 7 ? 'completed' : (daysSinceOrder >= 2 && daysSinceOrder < 7) ? 'active' : ''}">
                                    <div class="tracking-step-icon">
                                        <i class="fas fa-home"></i>
                                    </div>
                                    <div class="tracking-step-label">Delivered</div>
                                </div>
                            </div>
                            <p style="margin-top: 1rem; color: var(--text-light); font-size: 0.9rem;">
                                ${status === 'processing' ? 'Your order is being prepared for shipment.' :
                                  status === 'shipped' ? 'Your order is on its way! Expected delivery in 3-5 days.' :
                                  status === 'delivered' ? 'Your order has been delivered successfully!' :
                                  status === 'cancelled' ? 'This order has been cancelled.' : ''}
                            </p>
                        ${status !== 'cancelled' ? '</div>' : ''}
                        
                        <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
                            ${status === 'processing' ? `
                                <button class="cancel-order-btn" onclick="cancelOrder('${order.id}')" style="background: #e74c3c; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600; transition: var(--transition);">
                                    <i class="fas fa-times" style="margin-right: 0.5rem;"></i>
                                    Cancel Order
                                </button>
                            ` : ''}
                            <button class="customer-service-btn" onclick="openCustomerService()" style="background: var(--secondary); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600; transition: var(--transition);">
                                <i class="fas fa-headset" style="margin-right: 0.5rem;"></i>
                                Customer Service
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function fillPreviousAddress(addressData) {
            document.querySelector('input[name="firstName"]').value = addressData.firstName;
            document.querySelector('input[name="lastName"]').value = addressData.lastName;
            document.querySelector('input[name="email"]').value = addressData.email;
            document.querySelector('input[name="phone"]').value = addressData.phone;
            document.querySelector('input[name="address"]').value = addressData.address;
            document.querySelector('input[name="city"]').value = addressData.city;
            document.querySelector('input[name="pincode"]').value = addressData.pincode;
            document.querySelector('select[name="state"]').value = addressData.state;
        }

        function clearAddressForm() {
            document.querySelector('input[name="firstName"]').value = '';
            document.querySelector('input[name="lastName"]').value = '';
            document.querySelector('input[name="email"]').value = '';
            document.querySelector('input[name="phone"]').value = '';
            document.querySelector('input[name="address"]').value = '';
            document.querySelector('input[name="city"]').value = '';
            document.querySelector('input[name="pincode"]').value = '';
            document.querySelector('select[name="state"]').value = '';
        }

        function cancelOrder(orderId) {
            if (confirm('Are you sure you want to cancel this order? This action cannot be undone.')) {
                const orders = JSON.parse(localStorage.getItem('orders')) || [];
                const orderIndex = orders.findIndex(order => order.id === orderId);
                
                if (orderIndex !== -1) {
                    orders[orderIndex].status = 'cancelled';
                    localStorage.setItem('orders', JSON.stringify(orders));
                    showNotification('Order cancelled successfully', 'success');
                    renderOrders();
                }
            }
        }

        function openCustomerService() {
            const customerServiceModal = document.createElement('div');
            customerServiceModal.className = 'modal active';
            customerServiceModal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
                    <div style="padding: 2rem; text-align: center;">
                        <i class="fas fa-headset" style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
                        <h2 style="color: var(--primary); margin-bottom: 1rem;">Customer Service</h2>
                        <p style="margin-bottom: 2rem; color: var(--text-light);">Need help with your order? Our customer service team is here to assist you!</p>
                        
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            <a href="tel:+911234567890" style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--neutral-light); border-radius: 12px; text-decoration: none; color: var(--text-dark); transition: var(--transition);">
                                <i class="fas fa-phone" style="color: var(--primary);"></i>
                                <div style="text-align: left;">
                                    <div style="font-weight: 600;">Call Us</div>
                                    <div style="font-size: 0.9rem; color: var(--text-light);">+91 123 456 7890</div>
                                </div>
                            </a>
                            
                            <a href="mailto:support@elinfragrance.com" style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--neutral-light); border-radius: 12px; text-decoration: none; color: var(--text-dark); transition: var(--transition);">
                                <i class="fas fa-envelope" style="color: var(--primary);"></i>
                                <div style="text-align: left;">
                                    <div style="font-weight: 600;">Email Us</div>
                                    <div style="font-size: 0.9rem; color: var(--text-light);">support@elinfragrance.com</div>
                                </div>
                            </a>
                            
                            <a href="https://wa.me/911234567890" target="_blank" rel="noopener noreferrer" style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--neutral-light); border-radius: 12px; text-decoration: none; color: var(--text-dark); transition: var(--transition);">
                                <i class="fab fa-whatsapp" style="color: #25D366;"></i>
                                <div style="text-align: left;">
                                    <div style="font-weight: 600;">WhatsApp</div>
                                    <div style="font-size: 0.9rem; color: var(--text-light);">Chat with us instantly</div>
                                </div>
                            </a>
                        </div>
                        
                        <p style="margin-top: 1.5rem; font-size: 0.9rem; color: var(--text-light);">
                            <strong>Business Hours:</strong><br>
                            Monday - Saturday: 9:00 AM - 8:00 PM<br>
                            Sunday: 10:00 AM - 6:00 PM
                        </p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(customerServiceModal);
            
            // Add hover effects
            customerServiceModal.querySelectorAll('a').forEach(link => {
                link.addEventListener('mouseenter', function() {
                    this.style.background = 'var(--secondary)';
                    this.style.color = 'var(--white)';
                });
                link.addEventListener('mouseleave', function() {
                    this.style.background = 'var(--neutral-light)';
                    this.style.color = 'var(--text-dark)';
                });
            });
        }

        // Smooth scrolling for anchor links
        document.addEventListener('click', function(e) {
            if (e.target.matches('a[href^="#"]')) {
                e.preventDefault();
                const href = e.target.getAttribute('href');
                if (href && href !== '#') {
                    const target = document.querySelector(href);
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth' });
                    }
                }
            }
        });

        // Add some entrance animations
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver(function(entries) {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                }
            });
        }, observerOptions);

        // Authentication Functions
        function updateProfileSection() {
            const profileSection = document.getElementById('profile-section');
            
            if (currentUser) {
                profileSection.innerHTML = `
                    <div class="profile-btn" onclick="showProfileMenu()" style="cursor: pointer;">
                        <i class="fas fa-user"></i>
                        <span>${currentUser.username}</span>
                    </div>
                `;
            } else {
                profileSection.innerHTML = `
                    <button class="signup-btn" onclick="openAuthModal()">
                        <i class="fas fa-user-plus"></i>
                        Sign Up
                    </button>
                `;
            }
        }

        function openAuthModal() {
            document.getElementById('auth-modal').classList.add('active');
        }

        function closeAuthModal() {
            document.getElementById('auth-modal').classList.remove('active');
        }

        function switchAuthTab(tab) {
            // Remove active class from all tabs and forms
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            // Add active class to selected tab and form
            if (tab === 'login') {
                document.querySelector('.auth-tab:first-child').classList.add('active');
                document.getElementById('login-form').classList.add('active');
            } else if (tab === 'signup') {
                document.querySelector('.auth-tab:last-child').classList.add('active');
                document.getElementById('signup-form').classList.add('active');
            } else if (tab === 'forgot') {
                document.getElementById('forgot-form').classList.add('active');
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const email = formData.get('email');
            const password = formData.get('password');
            
            // Get stored users
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateProfileSection();
                closeAuthModal();
                showNotification('Login successful!', 'success');
            } else {
                showNotification('Invalid email or password', 'error');
            }
        }

        function handleSignup(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const userData = {
                username: formData.get('username'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                password: formData.get('password'),
                confirmPassword: formData.get('confirmPassword')
            };
            
            // Validate passwords match
            if (userData.password !== userData.confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            // Check if user already exists
            const users = JSON.parse(localStorage.getItem('users')) || [];
            if (users.find(u => u.email === userData.email)) {
                showNotification('User already exists with this email', 'error');
                return;
            }
            
            // Add new user
            const newUser = {
                id: Date.now(),
                username: userData.username,
                email: userData.email,
                phone: userData.phone,
                password: userData.password
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            // Auto login
            currentUser = newUser;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            updateProfileSection();
            closeAuthModal();
            showNotification('Account created successfully!', 'success');
        }

        function handleForgotPassword(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const email = formData.get('email');
            
            // Check if user exists
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const user = users.find(u => u.email === email);
            
            if (user) {
                showNotification('Password reset link sent to your email!', 'success');
                closeAuthModal();
            } else {
                showNotification('No account found with this email', 'error');
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            updateProfileSection();
            showNotification('Logged out successfully', 'success');
        }

        function showProfileMenu() {
            const profileMenu = document.createElement('div');
            profileMenu.className = 'modal active';
            profileMenu.innerHTML = `
                <div class="modal-content" style="max-width: 300px;">
                    <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
                    <div style="padding: 2rem; text-align: center;">
                        <i class="fas fa-user-circle" style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
                        <h3 style="color: var(--primary); margin-bottom: 0.5rem;">${currentUser.username}</h3>
                        <p style="color: var(--text-light); margin-bottom: 2rem;">${currentUser.email}</p>
                        
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            <button onclick="this.closest('.modal').remove(); navigateToPage('orders');" style="padding: 0.75rem; background: var(--secondary); color: white; border: none; border-radius: 8px; cursor: pointer;">
                                <i class="fas fa-box" style="margin-right: 0.5rem;"></i>
                                My Orders
                            </button>
                            <button onclick="this.closest('.modal').remove(); navigateToPage('wishlist');" style="padding: 0.75rem; background: var(--secondary); color: white; border: none; border-radius: 8px; cursor: pointer;">
                                <i class="fas fa-heart" style="margin-right: 0.5rem;"></i>
                                My Wishlist
                            </button>
                            <button onclick="logout(); this.closest('.modal').remove();" style="padding: 0.75rem; background: #e74c3c; color: white; border: none; border-radius: 8px; cursor: pointer;">
                                <i class="fas fa-sign-out-alt" style="margin-right: 0.5rem;"></i>
                                Logout
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(profileMenu);
        }

        // Wishlist Functions
        function toggleWishlist(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const existingIndex = wishlist.findIndex(item => item.id === productId);
            
            if (existingIndex > -1) {
                wishlist.splice(existingIndex, 1);
                showNotification('Removed from wishlist', 'success');
            } else {
                wishlist.push({
                    id: product.id,
                    name: product.name,
                    image: product.image,
                    sizes: product.sizes,
                    description: product.description
                });
                showNotification('Added to wishlist!', 'success');
            }
            
            localStorage.setItem('wishlist', JSON.stringify(wishlist));
            updateWishlistButton(productId);
            
            if (currentPage === 'wishlist') {
                renderWishlist();
            }
        }

        function updateWishlistButton(productId) {
            const btn = document.getElementById(`wishlist-btn-${productId}`);
            if (btn) {
                const isInWishlist = wishlist.some(item => item.id === productId);
                btn.classList.toggle('active', isInWishlist);
            }
        }

        function renderWishlist() {
            const container = document.getElementById('wishlist-items');
            
            if (wishlist.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-heart"></i>
                        <h3>Your wishlist is empty</h3>
                        <p>Save your favorite fragrances here!</p>
                        <a href="#" class="cta-button mt-4" data-page="shop">Start Shopping</a>
                    </div>
                `;
                // Re-attach event listeners
                container.querySelector('[data-page]').addEventListener('click', function(e) {
                    e.preventDefault();
                    navigateToPage(this.dataset.page);
                });
                return;
            }
            
            container.innerHTML = wishlist.map(item => {
                const minPrice = Math.min(...item.sizes.map(s => s.price));
                const maxPrice = Math.max(...item.sizes.map(s => s.price));
                const priceDisplay = minPrice === maxPrice ? `₹${minPrice}` : `₹${minPrice} - ₹${maxPrice}`;
                
                return `
                    <div class="cart-item">
                        <div class="cart-item-image" style="background-image: url(${item.image})"></div>
                        <div class="cart-item-info">
                            <h3>${item.name}</h3>
                            <p>${item.description}</p>
                            <div class="cart-item-price">${priceDisplay}</div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <button onclick="openProductModal(${item.id})" style="background: var(--primary); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">
                                View Details
                            </button>
                            <button onclick="toggleWishlist(${item.id})" style="background: #e74c3c; color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">
                                Remove
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Observe elements for animation
        setTimeout(() => {
            document.querySelectorAll('.product-card, .hero-content, .section-title').forEach(el => {
                observer.observe(el);
            });
        }, 100);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'988e5021356333a8',t:'MTc1OTUxNDE1My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
